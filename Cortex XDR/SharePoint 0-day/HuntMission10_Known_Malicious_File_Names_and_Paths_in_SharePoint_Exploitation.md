# Detection of Known Malicious File Names and Paths in SharePoint Exploitation

## Severity or Impact of the Detected Behavior
- **Risk Score:** 90
- **Severity:** Critical

## Hunt Analytics Metadata

- **ID:** HuntQuery-SharePoint-KnownMaliciousFiles
- **Operating Systems:** WindowsServer, SharePoint
- **False Positive Rate:** Very Low

---

## Hunt Analytics

This hunt detects the creation or writing of known malicious files and paths associated with SharePoint exploitation. It focuses on file events where `spinstall0.aspx` or `debug_dev.js` are written to SharePoint LAYOUTS directories by `powershell.exe`. These file names and paths have been observed in active exploitation campaigns and are strong indicators of post-exploitation activity, webshell deployment, or attacker tooling.

Detected behaviors include:

- File creation or write events for `spinstall0.aspx` or `debug_dev.js` in SharePoint LAYOUTS directories
- File operations performed by `powershell.exe`
- Collection of file path, file name, SHA256, and process context for investigation

These patterns are indicative of webshell deployment, persistence, and attacker tooling on SharePoint servers.

---

## ATT&CK Mapping

| Tactic                        | Technique   | Subtechnique | Technique Name                                 |
|------------------------------|-------------|--------------|-----------------------------------------------|
| TA0001 - Initial Access       | T1190       | —            | Exploit Public-Facing Application             |
| TA0008 - Persistence         | T1505.003   | —            | Server Software Component: Web Shell           |
| TA0002 - Execution           | T1059.001   | —            | Command and Scripting Interpreter: PowerShell  |

---

## Hunt Query Logic

This query identifies malicious file creation by looking for:

- File creation or write events for `spinstall0.aspx` or `debug_dev.js` in SharePoint LAYOUTS directories
- File operations performed by `powershell.exe`
- Relevant metadata such as timestamp, file name, file path, SHA256, and process details

These patterns are indicative of successful webshell deployment or attacker tooling on SharePoint servers.

---

## Hunt Query Syntax

**Query Language:** XQL (Cortex Query Language)  
**Platform:** Polo Alto Networks Cortex XDR and XSIAM

```xql
// Description: This query identifies known file names and paths observed during exploitation
dataset = xdr_data 
| filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_WRITE, ENUM.FILE_CREATE_NEW) and (lowercase(action_file_path) in ("c:\program files\common files\microsoft shared\web server extensions\16\template\layouts\spinstall0.aspx","c:\program files\common files\microsoft shared\web server extensions\15\template\layouts\spinstall0.aspx", "c:\program files\common files\microsoft shared\web server extensions\16\template\layouts\debug_dev.js") or lowercase(action_file_name) = "spinstall0.aspx") and lowercase(actor_process_image_name) = "powershell.exe"
| fields _time, agent_hostname, causality_actor_process_image_name, actor_process_image_name, actor_process_command_line, action_file_name, action_file_path, action_file_sha256, event_type, event_sub_type 
```

---

## Data Sources

| Log Provider   | Event Name   | ATT&CK Data Source | ATT&CK Data Component |
|---------------|--------------|--------------------|-----------------------|
| Cortex XSIAM  | xdr_data     | File               | File Creation, File Write |

---

## Execution Requirements

- **Required Permissions:** Ability to collect and analyze file creation and write logs from SharePoint servers.
- **Required Artifacts:** File event logs, file name, file path, SHA256 hash, process and command line details.

---

## Considerations

- Review the process and command line responsible for creating or writing the file.
- Correlate with network and authentication logs for evidence of exploitation or lateral movement.
- Investigate any follow-on activity from the same host or user account.
- Validate if the SharePoint instance is patched for known vulnerabilities.

---

## False Positives

False positives are extremely unlikely due to the specificity of the file names, paths, and process context.

---

## Recommended Response Actions

1. Immediately isolate the affected server.
2. Investigate the process and user responsible for the file creation or write event.
3. Remove any malicious files and perform a full forensic analysis.
4. Apply security patches for any relevant SharePoint vulnerabilities.
5. Monitor for additional suspicious activity or persistence mechanisms.

---

## References

- [MITRE ATT&CK: T1190 – Exploit Public-Facing Application](https://attack.mitre.org/techniques/T1190/)
- [MITRE ATT&CK: T1505.003 – Server Software Component: Web Shell](https://attack.mitre.org/techniques/T1505/003/)
- [MITRE ATT&CK: T1059.001 – Command and Scripting Interpreter: PowerShell](https://attack.mitre.org/techniques/T1059/001/)
- [Microsoft Security Blog: Disrupting Active Exploitation of On-Premises SharePoint Vulnerabilities (July 22, 2025)](https://www.microsoft.com/en-us/security/blog/2025/07/22/disrupting-active-exploitation-of-on-premises-sharepoint-vulnerabilities/)
- [Unit 42: Microsoft SharePoint CVE-2025-49704, CVE-2025-49706, CVE-2025-53770 Analysis](https://unit42.paloaltonetworks.com/microsoft-sharepoint-cve-2025-49704-cve-2025-49706-cve-2025-53770/)
- [Eye Security: SharePoint Under Siege](https://research.eye.security/sharepoint-under-siege/)

---

## Version History

| Version | Date       | Impact            | Notes                                                                                      |
|---------|------------|-------------------|--------------------------------------------------------------------------------------------|
| 1.0     | 2025-07-22 | Initial Detection | Created hunt query to detect known malicious file names and paths in SharePoint exploitation |
